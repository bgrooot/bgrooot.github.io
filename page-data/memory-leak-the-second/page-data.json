{"componentChunkName":"component---src-templates-post-tsx","path":"/memory-leak-the-second/","result":{"data":{"markdownRemark":{"html":"<p><strong>블로그를 날려먹었다가 복구해서 이미지가 깨져있습니다 ㅠㅠ</strong><br>\n<em>(사내 위키에 썼었던 글을 옮깁니다.)</em></p>\n<p>실험 결과로서 타임아웃을 줄이는 것이 메모리와 관계가 있다는 것은 알았지만 왜 그런지 궁금하여 조사해 본 결과를 정리해 보았습니다. (원래 스프링 시큐리티의 구조를 간단히 설명하는 글을 저도 공부하면서 써볼까 했는데 시간이 오래 걸려 미루었습니다...)</p>\n<h3 id=\"filter-chain\" style=\"position:relative;\"><a href=\"#filter-chain\" aria-label=\"filter chain permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Filter Chain</h3>\n<p>스프링 시큐리티는 요청을 필터 체인으로 동작합니다. 세션을 사용 하는 필터는 <code class=\"language-text\">SecurityContextPersistenceFilter</code>와 <code class=\"language-text\">SessionManagementFilter</code>가 있는데 간략화해서 <code class=\"language-text\">SecurityContextPersistenceFilter</code>의 동작에 대해서만 기술하려고 합니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 265px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/629a2d139fd35442c0cc02ec31cd72d9/8880c/spring-security-filter-chain.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 71.42857142857143%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAIF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB2gUD/8QAFhABAQEAAAAAAAAAAAAAAAAAARAg/9oACAEBAAEFAhwT/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFRABAQAAAAAAAAAAAAAAAAAAARD/2gAIAQEABj8Ca3//xAAYEAEBAQEBAAAAAAAAAAAAAAABABEhYf/aAAgBAQABPyHhB3IfWDkXC2//2gAMAwEAAgADAAAAEFDP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHBABAAEEAwAAAAAAAAAAAAAAAQARITFxUZGx/9oACAEBAAE/EEELXjBqqmaxKekp7IhpzBcvc//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"spring security filter chain\"\n        title=\"spring security filter chain\"\n        src=\"/static/629a2d139fd35442c0cc02ec31cd72d9/8880c/spring-security-filter-chain.jpg\"\n        srcset=\"/static/629a2d139fd35442c0cc02ec31cd72d9/e2e20/spring-security-filter-chain.jpg 140w,\n/static/629a2d139fd35442c0cc02ec31cd72d9/8880c/spring-security-filter-chain.jpg 265w\"\n        sizes=\"(max-width: 265px) 100vw, 265px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"securitycontextholder\" style=\"position:relative;\"><a href=\"#securitycontextholder\" aria-label=\"securitycontextholder permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SecurityContextHolder</h3>\n<p>스프링 시큐리티에서 인증된 사용자의 정보를 저장하는 곳 입니다. 인증된 사용자는 Context에 정보가 채워지게 됩니다. ThreadLocal로 구현되어 있습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 370px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2ff970e28d488d19a9a483132442da97/1efb2/spring-security-context-holder.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.42857142857142%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAABpklEQVQY0x2KbU/aUACF+0uXZWbD6bclJjoi7osftrklpi0VUKJQ+kIR0NFAe3uhhbYUkbW4KEJUXGDGKCO+0GuXLZnV5OTJc3IOpji/5sRJUHKDEpov3Lxarb2NOdOR5hSuz6w7b6hGYK3p8+XX8osvMLB+EJS996XJQtENAYSJ1ilnjas9BDuucnQvWv2IoIZ5GOUBJagkq1AcWBPUWEYTlAOxOVR7D7Az0Xpoy7zFpL3+9+746sYbjtDFCF1P/jecHtTb9VYH6HbZ+FHbO4S6bbS6w99/rm7/+Z/BNRrfecAZY5JxOB+3Q+DvkvSwWHJDshfcHc1S5mu8NhvdD5DGTKQ1TZrv6I4/hSS0KKEl2fsgu3jpEiuozqdEPWcN0urxbuNnVj/ZNs5X+FayYMWzWjyv+4wK2orQ3qmf8ZXjfL3Plo/y5jkhDrB8pb1MKSJo0rxIp0tUlMkVG0TaZrdhgi3SAthixQ1G/rhpprhv8eQOl5E3EjkuCz9nTjHT7uJJQDJqmNWIVIVkNJwukynoO5FSyef4EmafapjRnr1KMFoS9h8BlNMtYed7Kz4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"spring security context holder\"\n        title=\"spring security context holder\"\n        src=\"/static/2ff970e28d488d19a9a483132442da97/1efb2/spring-security-context-holder.png\"\n        srcset=\"/static/2ff970e28d488d19a9a483132442da97/0d3e1/spring-security-context-holder.png 140w,\n/static/2ff970e28d488d19a9a483132442da97/908b1/spring-security-context-holder.png 280w,\n/static/2ff970e28d488d19a9a483132442da97/1efb2/spring-security-context-holder.png 370w\"\n        sizes=\"(max-width: 370px) 100vw, 370px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"securitycontextpersistencefilter\" style=\"position:relative;\"><a href=\"#securitycontextpersistencefilter\" aria-label=\"securitycontextpersistencefilter permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SecurityContextPersistenceFilter</h3>\n<p>이 필터는 필터 체인 중에 상위에 위치하여 <code class=\"language-text\">SecurityContextRepository</code> 인터페이스로 부터 얻는 정보로 <code class=\"language-text\">SecurityContextHolder</code>를 채워 줍니다. 코드를 보면 아래와 같은 순서로 수행됩니다.</p>\n<ol>\n<li>SecurityContextRepository에서 SecurityContext를 가지고 옴. 불러온 SecurityContext를 SecurityContextHolder에 설정.</li>\n<li>체인 필터 수행.</li>\n<li>SecurityContextHolder 클리어.</li>\n<li>저장되어 있던 SecurityContextHolder를 SecurityContextRepository에 저장.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doFilter</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ServletRequest</span> req<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletResponse</span> res<span class=\"token punctuation\">,</span> <span class=\"token class-name\">FilterChain</span> chain<span class=\"token punctuation\">)</span>\n                <span class=\"token keyword\">throws</span> <span class=\"token class-name\">IOException</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ServletException</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token punctuation\">.</span>\n        <span class=\"token punctuation\">.</span>\n        <span class=\"token punctuation\">.</span>\n\n        <span class=\"token class-name\">HttpRequestResponseHolder</span> holder <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpRequestResponseHolder</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span>\n                response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">SecurityContext</span> contextBeforeChainExecution <span class=\"token operator\">=</span> repo<span class=\"token punctuation\">.</span><span class=\"token function\">loadContext</span><span class=\"token punctuation\">(</span>holder<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">SecurityContextHolder</span><span class=\"token punctuation\">.</span><span class=\"token function\">setContext</span><span class=\"token punctuation\">(</span>contextBeforeChainExecution<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            chain<span class=\"token punctuation\">.</span><span class=\"token function\">doFilter</span><span class=\"token punctuation\">(</span>holder<span class=\"token punctuation\">.</span><span class=\"token function\">getRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> holder<span class=\"token punctuation\">.</span><span class=\"token function\">getResponse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">SecurityContext</span> contextAfterChainExecution <span class=\"token operator\">=</span> <span class=\"token class-name\">SecurityContextHolder</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token comment\">// Crucial removal of SecurityContextHolder contents - do this before anything</span>\n            <span class=\"token comment\">// else.</span>\n            <span class=\"token class-name\">SecurityContextHolder</span><span class=\"token punctuation\">.</span><span class=\"token function\">clearContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            repo<span class=\"token punctuation\">.</span><span class=\"token function\">saveContext</span><span class=\"token punctuation\">(</span>contextAfterChainExecution<span class=\"token punctuation\">,</span> holder<span class=\"token punctuation\">.</span><span class=\"token function\">getRequest</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                    holder<span class=\"token punctuation\">.</span><span class=\"token function\">getResponse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            request<span class=\"token punctuation\">.</span><span class=\"token function\">removeAttribute</span><span class=\"token punctuation\">(</span><span class=\"token constant\">FILTER_APPLIED</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token punctuation\">.</span>\n            <span class=\"token punctuation\">.</span>\n            <span class=\"token punctuation\">.</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>기본적으로 <code class=\"language-text\">SecurityContextRepository</code>는 HttpSession을 사용하는 <code class=\"language-text\">HttpSessionSecurityContextRepository</code>으로 설정되어 Session에 저장하게 됩니다. 요약하자면, 인증 필터들이 수행되기 전에 인증 정보를 세션에서 꺼내서 설정 해주고 필터가 수행되면 다시 세션에 저장해 줍니다. 그렇다면… 세션에 설정한다는 것이 어떤 의미를 가지고 있을까요?</p>\n<h3 id=\"session\" style=\"position:relative;\"><a href=\"#session\" aria-label=\"session permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Session</h3>\n<p>나무위키에는 아래와 같이 설명하고 있습니다.</p>\n<blockquote>\n<p>웹 서버에서 임시로 클라이언트의 데이터를 갈무리하는 것을 뜻한다. 쿠키와 역할이 비슷한데, 쿠키는 클라이언트 측에 데이터를 갈무리하는 반면에 세션은 서버 측에 데이터를 갈무리해 놓는다는 차이점이 있다. 주로 로그인, 온라인 쇼핑몰의 장바구니 등에 쓰인다.</p>\n</blockquote>\n<p>클라이언트의 정보를 서버에 저장하는 것 정도가 되겠습니다. 세션은 파일, DB, In-Memory, Redis 등등에 저장할 수 있는데 우리가 쓰는 Undertow에서는 InMemorySessionManager를 기본으로 사용하여 In-Memory에 세션을 저장합니다. 다시 위의 요약으로 돌아가서 세션에서 꺼내 인증 상태로 만드다는 것은 클라이언트와 서버에서 사용하는 HTTP 프로토콜은 무상태성(Stateless)을 가지고 있는데 동일한 세션이고 이미 인증되었다면 인증된 상태로 만들어 주는 것이라고 할 수 있겠습니다.</p>\n<h3 id=\"그래서\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%9E%98%EC%84%9C\" aria-label=\"그래서 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그래서?</h3>\n<p>우리 플랫폼에서 인증은 펠릭스가 만들어 준 람다에서 처리하고 결과를 모든 클라이언트 요청은 헤더에 담아서 보내줍니다. 그렇기 때문에 지금에야 드는 생각이지만, 요청 끼리 인증 결과를 공유하지 않아도 될 듯 합니다. 세션에서 인증된 결과를 불러와 <code class=\"language-text\">SecurityContextPersistenceFilter</code>뒤의 인증 필터들(UsernamePasswordAuthenticationFilter, BasicAuthenticationFilter)에서의 인증 시도를 건너뛴다고 하더라도 인증 필터에서 오래 소요되는 작업을 하는 것이 아니기 때문에 큰 영향은 없을 듯 합니다. (타암아웃을 설정했을 때와 하지 않았을 때의 TPS를 측정해 보면 명확할 것 같습니다.)</p>\n<p>찾아보니 Spring Security Config에는 SessionManagement에서 세션 관련 설정을 할 수 있도록 되어 있습니다. SessionManagement에는 설정 필드들 중에는 최대로 생성할 수 있는 세션 수를 설정하는 maximumSessions와 (기본값은 제한이 없습니다.) 세션 생성방식을 설정하는 sessionCreationPolicy가 있습니다. sessionCreationPolicy에는 아래와 같은 값을 설정할 수 있습니다.</p>\n<ul>\n<li>ALWAYS - 항상 HttpSession을 생성합니다.</li>\n<li>NEVER - HttpSession이 있을 때만 사용하고 만들지는 않습니다.</li>\n<li>IF_REQUIRED - 필요할 때만 HttpSession을 만듭니다. (기본 값)</li>\n<li>STATELESS - HttpSession을 만들지 않고 사용하지도 않습니다.</li>\n</ul>\n<p>HttpSession을 만들고 사용하지 않기위해 STATELESS로 설정하려고 합니다. 값이 STATELESS일 때는 <code class=\"language-text\">SecurityContextRepository</code>로 <code class=\"language-text\">NullSecurityContextRepository</code>가 선택됩니다. <code class=\"language-text\">NullSecurityContextRepository</code>는 아래와 같이 <code class=\"language-text\">SecurityContextPersistenceFilter</code>의 필터에서 아무런 일도 하지 않습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">NullSecurityContextRepository</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">SecurityContextRepository</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">containsContext</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">SecurityContext</span> <span class=\"token function\">loadContext</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpRequestResponseHolder</span> requestResponseHolder<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token class-name\">SecurityContextHolder</span><span class=\"token punctuation\">.</span><span class=\"token function\">createEmptyContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">saveContext</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SecurityContext</span> context<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그럼 이제 테스트를 해봐야겠습니다.</p>\n<h2 id=\"테스트\" style=\"position:relative;\"><a href=\"#%ED%85%8C%EC%8A%A4%ED%8A%B8\" aria-label=\"테스트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>테스트</h2>\n<p>커뮤니티 DEV를 대상으로 저번과 같이 댓글 조회하는 API를 호출하려고 합니다. Scouter 띄우고 nGinder로 부하를 줘 세션 타임아웃 기본 값(30m)으로 두었을 때와 적게 조절 (5m) 했을 때, 그리고 세션을 설정하지 않았을 때의 TPS와 Heap Memory 사용율을 확인해 보려고 합니다. nGinder에서 500명의 사용자로 10분간 계속 호출 하도록 합니다. JAVA_OPTS는 아래처럼 설정했습니다. CMS GC를 사용합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"plain\"><pre class=\"language-plain\"><code class=\"language-plain\">java -javaagent:/home/webapp/scouter/agent.java/scouter.agent.jar\n     -Dscouter.config=/home/webapp/scouter/agent.java/conf/scouter.conf\n     -Dobj_name=community-dev\n     -Dfile.encoding=UTF-8 -verbosegc\n     -Xloggc:/var/log/gc.log\n     -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:GCLogFileSize=10m -XX:NumberOfGCLogFiles=100\n     -XX:+UseParNewGC -XX:+CMSParallelRemarkEnabled -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=75 -jar application.jar</code></pre></div>\n<h3 id=\"세션-타임-아웃이-기본-값-30분-일-때\" style=\"position:relative;\"><a href=\"#%EC%84%B8%EC%85%98-%ED%83%80%EC%9E%84-%EC%95%84%EC%9B%83%EC%9D%B4-%EA%B8%B0%EB%B3%B8-%EA%B0%92-30%EB%B6%84-%EC%9D%BC-%EB%95%8C\" aria-label=\"세션 타임 아웃이 기본 값 30분 일 때 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>세션 타임 아웃이 기본 값 (30분) 일 때</h3>\n<p>지난 번에 테스트 했던 상황입니다. Heap 메모리가 점차 차오르다가 6분정도가 지났을 때 TPS가 급감했습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 326px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/94a99f8cba177beaebf92b5c50a6a953/ce9b1/session-timeout-30m-tps.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.85714285714286%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsTAAALEwEAmpwYAAABRklEQVQoz5VR2W6DMBDk/3+tfaxUtSlpymEIScj6Nr7omKgRr7VGq/HaM4yXavn/ir6slFKljXaGeye9ExtA5GIF4DYsrnBUZzmq0sQuI6c5xgix0YZiUAYWi3AL7vGcdAoqJZ2jxlHwct06a9TguK/k/SHW3yNrzuzI2rfmdOjbdmKfffPF2uPQn8Ye/MBav8jkVfQSgKNWm9hYM86TdTx4FRaB76SouZqBWdyM5RNdpSbrxJrMmm1OJmeIeAyxkkqRnHEAyxI1qIf3E8hpLL3U9euxRrSfyzDM524aysCkMTBes0k7QbH/48U3qJu4NZehHroP1r3jIV1bxEhgDYVtTv6JRfj91vEU8OYyNmeJxNVpCojtnBNSSFUgJFcKGw7OOYFzQRjOgxOqlne6K3QE4VdXWhvoYYMYsaz0xNbZ17ivOedfcCU+GD8D2VgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"session timeout 30m tps\"\n        title=\"session timeout 30m tps\"\n        src=\"/static/94a99f8cba177beaebf92b5c50a6a953/ce9b1/session-timeout-30m-tps.png\"\n        srcset=\"/static/94a99f8cba177beaebf92b5c50a6a953/0d3e1/session-timeout-30m-tps.png 140w,\n/static/94a99f8cba177beaebf92b5c50a6a953/908b1/session-timeout-30m-tps.png 280w,\n/static/94a99f8cba177beaebf92b5c50a6a953/ce9b1/session-timeout-30m-tps.png 326w\"\n        sizes=\"(max-width: 326px) 100vw, 326px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 249px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0d93d290ae1ea7739d44b97c9457bace/6a5fb/session-timeout-30m-heap.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.42857142857143%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA/ElEQVQoz6VTa4+DIBD0///Ka79oLa0v3rvgDdBoz2hjrhOdoMvssLBUWusQAjNvuIAzdifEGCtjTAyxfOzyUSiJp2naTbzwJ2cs+8jzhLOU/3dW3zl/UXPa7dPOBavzeG63oSAiaXQ6V8abxUqpjc/SJHNOPwMxamev4nZpa+McwpQTVFKpVcBcZmPovLfe9XJ6jIMYh8u9EWMPZ2Uh94iGrTMH6307dNd789M2dfeoOzEo6ZnSQnLSPzVDTMyoB7Jb/6yfoukE0hNTfMNhh3kiRx6MJ7yKnE9dDK3Xo4qZ32/VB8AitSeOWmEjrH2xSowV4b/OKIMlVBj4BWHHrjjlH8KhAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"session timeout 30m heap\"\n        title=\"session timeout 30m heap\"\n        src=\"/static/0d93d290ae1ea7739d44b97c9457bace/6a5fb/session-timeout-30m-heap.png\"\n        srcset=\"/static/0d93d290ae1ea7739d44b97c9457bace/0d3e1/session-timeout-30m-heap.png 140w,\n/static/0d93d290ae1ea7739d44b97c9457bace/6a5fb/session-timeout-30m-heap.png 249w\"\n        sizes=\"(max-width: 249px) 100vw, 249px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"세션-타임-아웃을-5분으로-설정-했을-때\" style=\"position:relative;\"><a href=\"#%EC%84%B8%EC%85%98-%ED%83%80%EC%9E%84-%EC%95%84%EC%9B%83%EC%9D%84-5%EB%B6%84%EC%9C%BC%EB%A1%9C-%EC%84%A4%EC%A0%95-%ED%96%88%EC%9D%84-%EB%95%8C\" aria-label=\"세션 타임 아웃을 5분으로 설정 했을 때 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>세션 타임 아웃을 5분으로 설정 했을 때</h3>\n<p>Heap 메모리가 차는 6분 전에 세션이 만료되기 때문에 TPS가 급감하는 현상이 나타나지 않았습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 560px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5c4953a1b73effbab5697a83793f2e49/2e367/session-timeout-5m-tps.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.857142857142854%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABZUlEQVQoz11Sy1LDMAzM//8CM+VRQgc4wI9wAS70wJRHm3fqOLbjPNpFstO05bCj1Upay3GCu/AGz0+PeLgPsVjM8fb6guXHO6RIAVjsBw3szBi1i4wdo/c12yrkVQkhCgS34RXC8Brz+SVmswusVksyGtC2tYNtJYytHFQjYJrK6V1XO66NQG0qlLLElg2FriCUR1ELpNsMcZ4gKVLEhHUW4yeN8JVs8BmvHeeejLDOfS0qEupNENFcwCQvM+TckEXYkJhSzoYRDWwISemNv2n4N/OG8WiSi9ybk849Aa8+MPqaVhfQjUTfK/SkMbqWo6IrKnfNxkpYAutujvSh9zVLswEnuxEtfS8uHHL38R3Xk/Yfe45jHx8SuBM6X/Sb+vxcO9lmPHAYb3YwZt7S5kHPL0abHaNHZ73m+Ek+9Vo58UNuDRk2poamF24o0Yp+C02/Cb2807R0kTXF0RxrZqoduVYSfxurrbF8OP+wAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"session timeout 5m tps\"\n        title=\"session timeout 5m tps\"\n        src=\"/static/5c4953a1b73effbab5697a83793f2e49/b06ae/session-timeout-5m-tps.png\"\n        srcset=\"/static/5c4953a1b73effbab5697a83793f2e49/0d3e1/session-timeout-5m-tps.png 140w,\n/static/5c4953a1b73effbab5697a83793f2e49/908b1/session-timeout-5m-tps.png 280w,\n/static/5c4953a1b73effbab5697a83793f2e49/b06ae/session-timeout-5m-tps.png 560w,\n/static/5c4953a1b73effbab5697a83793f2e49/1e088/session-timeout-5m-tps.png 840w,\n/static/5c4953a1b73effbab5697a83793f2e49/2e367/session-timeout-5m-tps.png 1066w\"\n        sizes=\"(max-width: 560px) 100vw, 560px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 247px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/eff3b13396fdb4767523419ad09920a7/fb3c7/session-timeout-5m-heap.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 82.85714285714286%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAAsTAAALEwEAmpwYAAABO0lEQVQ4y51T2VKEMBDk/3/QY2st1+VeCGfIndgxqAgulsxD12SSZnoOIqWUtdbsWniwQlgkhPiTDNNa29X3PFnKfbI2xlkXHC4FaFJ5ilRqj6xDDmOY4KcsPuXxc3a9VDnwXMQT55Hckj/PSKi1ScntKb2AXPYNGfuE3LKmiknJpIgEF6GkUBn0QU9Lh4xUZdfkbf2YXoqO2J/mQs3LzHCg8K0uofCcJ9e6yJsaFTrntt1G0Hfby/NnV7TkXCQvZYp6KOeznDsD82SF1EpBhlASnXhIX7uJ4mJ+ZOy9OXvyyKZb32JV4NRDB9Qb+2rKEn3NjDMmhJnba38d293MWumwA0fWE4LN4d3+14/hN/wweZ0ZkwoNXLXXl7OJL82Tx3GcPoxSChwpZYwhyDgfhoExj5x/I26D3/f9O1Nb5Y0EWAOOAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"session timeout 5m heap\"\n        title=\"session timeout 5m heap\"\n        src=\"/static/eff3b13396fdb4767523419ad09920a7/fb3c7/session-timeout-5m-heap.png\"\n        srcset=\"/static/eff3b13396fdb4767523419ad09920a7/0d3e1/session-timeout-5m-heap.png 140w,\n/static/eff3b13396fdb4767523419ad09920a7/fb3c7/session-timeout-5m-heap.png 247w\"\n        sizes=\"(max-width: 247px) 100vw, 247px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"세션을-생성하지-않았을-때\" style=\"position:relative;\"><a href=\"#%EC%84%B8%EC%85%98%EC%9D%84-%EC%83%9D%EC%84%B1%ED%95%98%EC%A7%80-%EC%95%8A%EC%95%98%EC%9D%84-%EB%95%8C\" aria-label=\"세션을 생성하지 않았을 때 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>세션을 생성하지 않았을 때</h3>\n<p>TPS는 큰 차이는 없었고 Heap 메모리가 요청에 따라 증가하는 현상이 없었습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 353px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c898b8e8ad6b25dc05514db02899d8c0/6c115/no-session-tps.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.714285714285715%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABHUlEQVQY02VRi2rDMAzs///d2BisZbTJkqZtUku2pcSP2J7ija4wEMfp5JOEvEspEengrEQKHJyJgaK3a6DgbayxevKuKs6kQMQ4wmQN7HLOxmBa2TtjCAR5RktgGIR4byzDvGhpwbN2zqBVWoIQ8b6ZFaq39nQcuv356zwOzbX/6Nr2dt737eV+eW2O713Tj8Pn0DWX7qauUn05HQ99t5m1BmUm2SonXoNdIy2LLnlZo5WNUiRNSuaXNMt80cO2BWqtqtlgCDZHyvWp4DMX3FoEEnOKNY1UysKEu1LKHVS9kJWnglKT9I9XfFQFt/lpJgubeUKIQc5of7rWeOb/FTEzUzUjgvyWXI/ZgJo2hMpheigKJqJfRamRSQOob3XjyhWRE7GLAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"no session tps\"\n        title=\"no session tps\"\n        src=\"/static/c898b8e8ad6b25dc05514db02899d8c0/6c115/no-session-tps.png\"\n        srcset=\"/static/c898b8e8ad6b25dc05514db02899d8c0/0d3e1/no-session-tps.png 140w,\n/static/c898b8e8ad6b25dc05514db02899d8c0/908b1/no-session-tps.png 280w,\n/static/c898b8e8ad6b25dc05514db02899d8c0/6c115/no-session-tps.png 353w\"\n        sizes=\"(max-width: 353px) 100vw, 353px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 249px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5772325646060814d2e1802476936be4/6a5fb/no-session-heap.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.42857142857143%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsTAAALEwEAmpwYAAABQ0lEQVQoz6VSa2/CMAzs//91kyZNYxsIaCldC23zdJom6S5QymOwD+yErHC+q+3ECRc8hOC9fxQn3KSAREj5nHkYhkQIgT/OuUdxwk0qVpb/rDyKgv/b7K/Jw8wnc5hwbTtxV+QQCx9nDjFhbCdJW9cj9s7hB9L2VhmSRN55bQw08HTWtkqeZwbyZvexTdN9uayK+fcmrctacpDv+Xpe5quqQCqrK/DLXfFZZJx0UjW17XtBGoZZvoZ/UeZv2RIeKF5WX6/pYrZdI4LHV3AGCXGrRLJvW7ShOup6uxesFhwHQYppRZ0pWM20JNsdW42jGUJHUBprE9J6uqQJGCzc4mK3/Kg5v/P4+mHcgTtPdSLd4S7jhSmlnt/tuxv2G5ftnCtr0uEpxJmbpiEixhki51wfo9ZSRcgDcMAugUSMYsbIGLA/YJqmHpNV+4AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"no session heap\"\n        title=\"no session heap\"\n        src=\"/static/5772325646060814d2e1802476936be4/6a5fb/no-session-heap.png\"\n        srcset=\"/static/5772325646060814d2e1802476936be4/0d3e1/no-session-heap.png 140w,\n/static/5772325646060814d2e1802476936be4/6a5fb/no-session-heap.png 249w\"\n        sizes=\"(max-width: 249px) 100vw, 249px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"끝으로\" style=\"position:relative;\"><a href=\"#%EB%81%9D%EC%9C%BC%EB%A1%9C\" aria-label=\"끝으로 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>끝으로</h2>\n<ul>\n<li>SecurityContextHolder가 원인인줄 알았는데 Session에서 메모리를 많이 차지하는 현상으로 보입니다.</li>\n<li>인스턴스 사양을 변경하기 전에 세션 설정을 변경해야 겠습니다.</li>\n<li>그런데 실제로 Session을 사용하는 어플리케이션에서는 이런 현상을 어떻게 처리해야 할까요? 메모리를 많이 잡거나 타임아웃을 조절하는 수 밖에 없을까요?</li>\n<li>더 이상 메모리 문제는 없었으면 좋겠습니다.</li>\n</ul>","excerpt":"…","tableOfContents":"<ul>\n<li>\n<ul>\n<li><a href=\"/memory-leak-the-second/#filter-chain\">Filter Chain</a></li>\n<li><a href=\"/memory-leak-the-second/#securitycontextholder\">SecurityContextHolder</a></li>\n<li><a href=\"/memory-leak-the-second/#securitycontextpersistencefilter\">SecurityContextPersistenceFilter</a></li>\n<li><a href=\"/memory-leak-the-second/#session\">Session</a></li>\n<li><a href=\"/memory-leak-the-second/#%EA%B7%B8%EB%9E%98%EC%84%9C\">그래서?</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"/memory-leak-the-second/#%ED%85%8C%EC%8A%A4%ED%8A%B8\">테스트</a></p>\n<ul>\n<li><a href=\"/memory-leak-the-second/#%EC%84%B8%EC%85%98-%ED%83%80%EC%9E%84-%EC%95%84%EC%9B%83%EC%9D%B4-%EA%B8%B0%EB%B3%B8-%EA%B0%92-30%EB%B6%84-%EC%9D%BC-%EB%95%8C\">세션 타임 아웃이 기본 값 (30분) 일 때</a></li>\n<li><a href=\"/memory-leak-the-second/#%EC%84%B8%EC%85%98-%ED%83%80%EC%9E%84-%EC%95%84%EC%9B%83%EC%9D%84-5%EB%B6%84%EC%9C%BC%EB%A1%9C-%EC%84%A4%EC%A0%95-%ED%96%88%EC%9D%84-%EB%95%8C\">세션 타임 아웃을 5분으로 설정 했을 때</a></li>\n<li><a href=\"/memory-leak-the-second/#%EC%84%B8%EC%85%98%EC%9D%84-%EC%83%9D%EC%84%B1%ED%95%98%EC%A7%80-%EC%95%8A%EC%95%98%EC%9D%84-%EB%95%8C\">세션을 생성하지 않았을 때</a></li>\n</ul>\n</li>\n<li><a href=\"/memory-leak-the-second/#%EB%81%9D%EC%9C%BC%EB%A1%9C\">끝으로</a></li>\n</ul>","fields":{"slug":"/memory-leak-the-second/"},"frontmatter":{"title":"내가 겪은 메모리 누수 이야기 - 두 번째","date":"2020년 12월 1일 화요일","tags":["springSecurity","memoryLeak","springDataJpa"],"keywords":["Running Out Of Coins.","bgroot"],"update":"Jan 01, 0001"}}},"pageContext":{"slug":"/memory-leak-the-second/","series":[],"lastmod":"0001-01-01"}},"staticQueryHashes":["3649515864","63159454"]}